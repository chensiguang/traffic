<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.web.dao.CompanyDao">	<!-- 企业管理 -->	<resultMap id="BaseResultMap" type="com.web.pojo.Company">		<id 	column="comid" 		property="comid" 		jdbcType="INTEGER" />		<result column="comname" 	property="comname" 		jdbcType="VARCHAR" />		<result column="typeid" 	property="typeid" 		jdbcType="INTEGER" />		<result column="phone" 		property="phone" 		jdbcType="VARCHAR" />		<result column="mobile"     property="mobile" 		jdbcType="VARCHAR" />		<result column="linkname"  	property="linkname"  	jdbcType="VARCHAR" />		<result column="linkmobile" property="linkmobile" 	jdbcType="VARCHAR" />		<result column="addres" 	property="addres" 		jdbcType="VARCHAR" />		<result column="pid" 		property="pid" 			jdbcType="INTEGER" />		<result column="loginname" property="loginname" 	jdbcType="VARCHAR" />		<result column="password" 	property="password" 	jdbcType="VARCHAR" />		<result column="operid"   	property="operid" 		jdbcType="INTEGER" />	    <result column="opertime" 	property="opertime" 	jdbcType="TIMESTAMP" />	    <result column="regid" 		property="regid" 		jdbcType="INTEGER" />	    <result column="regtime" 	property="regtime" 		jdbcType="TIMESTAMP" />	    <result column="state" 		property="state" 		jdbcType="INTEGER" />	    <result column="remark" 	property="remark" 		jdbcType="VARCHAR" />	    	    <!-- 关联的PoliceOrg表 -->	    <collection  column="id" 		property="policeOrg" 		ofType="com.web.pojo.PoliceOrg" >	    	<id 	 column="id" 		property="id" 				jdbcType="INTEGER" />        			<result  column="orgname" 	property="orgname"			jdbcType="VARCHAR" /> 	    </collection>	        <collection property="admin" ofType="com.web.pojo.Admin">        <id property="userno" jdbcType="INTEGER" />       <result property="loginname" jdbcType="VARCHAR" />    </collection>	</resultMap>	  		<!-- 查找操作人 -->	<select id="selectUsernameById" resultMap="BaseResultMap"		parameterType="com.web.pojo.Company">		select i.*, u.loginname,u.userno,c.comname as companyname		 from tp_basic_company i 		 left join tp_sys_user u		  on i.operid = u.userno		 left join tp_basic_company c		 on i.pid = c.comid        where i.comid = #{id,jdbcType=INTEGER} 	</select> 		<!-- 前台显示 -->	<select id="selectCompanyList" resultMap="BaseResultMap" >	    select 	    	* 	    from tp_basic_company  	    where state = 1 	    order by regtime desc limit ${param1},${param2}   	</select>  		<select id="selectCount" resultType="java.lang.Integer" >	    select 	    	count(comid) 	    from tp_basic_company 	    where state = 1 	    order by regtime desc  	</select>  	<select id="selectCompanyInfoById" resultMap="BaseResultMap" >	    select 	    	* 	    from tp_basic_company  	    where state = 1 and comid = #{comid,jdbcType=INTEGER}  	</select>  	  	  	<!-- 后台管理 -->  	  	<!-- 查询所有 -->  	<select id="queryAll" resultMap="BaseResultMap">  		select   			*   		from tp_basic_company   		where state = 1    		order by regtime desc   	</select>  	  	<!-- 查询子公司 -->  	<select id="queryChildCompanyByDwid" resultMap="BaseResultMap">  		select *   		from tp_basic_company   		where state = 1    	    and pid = #{dwid}  	</select>  	  	<select id="queryComnameByDwid" resultMap="BaseResultMap">  		select *   		from tp_basic_company   		where state = 1 and comid = #{dwid}  	</select>  	  	<!-- 新增-提交，并且获取自增长Id号 -->  	<!-- useGeneratedKeys要求数据库本身具备主键自动增长的功能， -->  	<!-- 比如说，mysql、sqlserver可以使用useGeneratedKeys="true"功能， -->  	<!-- 不支持主键自动增长的数据库是不能使用useGeneratedKeys="true"， -->  	<!-- keyProperty="comid"表示自增长列。 -->  	<insert id="insertCompanyAndGetId" useGeneratedKeys="true" keyProperty="comid" parameterType="com.web.pojo.Company">		insert into tp_basic_company 		(			comid,comname,typeid,phone,mobile,linkname,linkmobile,addres,pid,			operid,opertime,state,remark,regtime,regid,loginname,password		)		values		(			#{id,jdbcType=INTEGER},	   		#{comname,jdbcType=VARCHAR},	   		#{typeid,jdbcType=INTEGER},	   		#{phone,jdbcType=VARCHAR},	   		#{mobile,jdbcType=VARCHAR},	   		#{linkname,jdbcType=VARCHAR},	   		#{linkmobile,jdbcType=VARCHAR},	   		#{addres,jdbcType=VARCHAR},	   		#{pid,jdbcType=INTEGER},	   		#{operid,jdbcType=VARCHAR},	   		#{opertime,jdbcType=TIMESTAMP},	   		#{state,jdbcType=INTEGER},	   		#{remark,jdbcType=VARCHAR},	   		#{regtime,jdbcType=TIMESTAMP},	   		#{regid,jdbcType=VARCHAR},	   		#{loginname,jdbcType=VARCHAR},	   		#{password,jdbcType=VARCHAR}		)  	</insert>  	  	<!-- 修改-编辑 -->  	<select id="queryDataById" resultMap="BaseResultMap" parameterType="java.lang.Integer">		select 			* 		from tp_basic_company bc 		left join tp_basic_porg_company oc 		on (bc.comid = oc.comid and oc.state = 1) 		left join tp_basic_policeorg po 		on (oc.orgid = po.id and po.state = 1) 		where bc.state = 1   		and bc.comid = #{comid,jdbcType=INTEGER}  	</select>  	  	<!-- 修改-提交 -->  	<update id="updateCompany" parameterType="com.web.pojo.Company">		update tp_basic_company 		set	   		comname     = #{comname,jdbcType=VARCHAR},	   		phone       = #{phone,jdbcType=VARCHAR},	   		mobile 		= #{mobile,jdbcType=VARCHAR},	   		linkname    = #{linkname,jdbcType=VARCHAR},	   		addres      = #{addres,jdbcType=VARCHAR},	   		operid      = #{operid,jdbcType=VARCHAR},	   		opertime    = #{opertime,jdbcType=TIMESTAMP},	   		remark      = #{remark,jdbcType=VARCHAR}, 	   		pid         = #{pid,jdbcType=INTEGER},	   		loginname = #{loginname,jdbcType=VARCHAR},	   		password = #{password,jdbcType=VARCHAR}  		where state = 1    		and comid = #{comid,jdbcType=INTEGER}  	</update>  	  	<!-- 单个删除、批量删除 -->  	<update id="dropDataById" parameterType="java.lang.Integer">		update tp_basic_company 		set	   		state = 0   		where state = 1    		and comid = #{id,jdbcType=INTEGER}  	</update>  	  	  	<!-- 增加安全组数量 -->  	<update id="addSafenum" parameterType="java.lang.Integer">		update tp_basic_company 		set safenum = safenum + 1		where state = 1  		and comid = #{id,jdbcType=INTEGER}  	</update>  	  	  	<!-- 删除安全组数量 -->  	<update id="plusSafenum" parameterType="java.lang.Integer">		update tp_basic_company 		set safenum = safenum - 1		where state = 1  		and comid = #{dwid,jdbcType=INTEGER}  	</update>  	  	<!-- 查看企业名称是否重复 -->  	<select id="selectCompanyByComName" resultType="java.lang.Integer" parameterType="com.web.pojo.Company">  		select   			count(*)  		from tp_basic_company   		where state = 1    		<if test="comid != null">  		and comid != #{comid,jdbcType=INTEGER}   		</if>  		<if test="comname != null">		and comname like concat('%',#{comname,jdbcType=VARCHAR},'%' )   		</if>  	</select>  	<!-- 后台分页管理 -->  	  	<!--查询总记录数 -->  	<select id="getCountByAll" resultType="java.lang.Integer" parameterType="java.util.HashMap">		select count(*)  		from tp_basic_company bc 		left join tp_basic_porg_company oc 		on (bc.comid = oc.comid and oc.state = 1) 		left join tp_basic_policeorg po 		on (oc.orgid = po.id and po.state = 1) 		where bc.state = 1 		<if test="comname != null">		 and bc.comnid = #{comname)   		</if>  		<if test="comid != null">		 and bc.comid = #{comid}		</if>  		order by bc.regtime desc   	</select>  	  	<!--分页、条件查询 -->  	<select id="selectPage" resultMap="BaseResultMap" parameterType="java.util.HashMap">		select bc.*,po.orgname,cc.comname as companyname		from tp_basic_company bc 		left join tp_basic_company cc 		on (bc.pid = cc.comid and cc.state = 1)		left join tp_basic_porg_company oc 		on (bc.comid = oc.comid and oc.state = 1) 		left join tp_basic_policeorg po 		on (oc.orgid = po.id and po.state = 1) 		where bc.state = 1 		<if test="comname != null">		and bc.comnid = #{comname)   		</if>  		<if test="comid != null">		and bc.comid = #{comid}		</if>  		order by bc.regtime desc limit #{curnum,jdbcType=INTEGER},#{pagesize,jdbcType=INTEGER}  	</select></mapper>